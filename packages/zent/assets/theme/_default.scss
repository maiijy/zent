// all the functions and mixin to get defined css variable and css property
// $attr: some custom attribute and html property

@import './variables/color';
@import './variables/text';

// sass-lint:disable no-duplicate-properties
// Colors
@function to-rgb($color) {
  @return red($color), green($color), blue($color);
}

@function is-old-theme($cat, $attr) {
  $colors: map-get($colors-map, $cat);
  $color: if($colors, map-get($colors, $attr), null);

  @if $color != null and $color {
    @return false;
  }
  @return true;
}

@function get-color-value($cat, $attr) {
  @return map-get(map-get($colors-map, $cat), $attr);
}

@function get-old-color($cat, $i) {
  $map-info: nth(map-get($theme-colors, $cat), $i);

  @return get-color-value(map-get($map-info, cat), map-get($map-info, attr));
}

@function get-css-prefix() {
  @return '--theme';
}

@function get-css-prefix-rgb() {
  @return '--theme-rbg';
}

@function get-css-var-name($cat, $attr) {
  @return #{$cat}-#{$attr};
}

@function get-old-css-var($cat, $i) {
  $map-info: nth(map-get($theme-colors, $cat), $i);
  // sass-lint:disable-block space-around-operator
  @return #{map-get($map-info, cat)}-#{map-get($map-info, attr)};
}

@function get-color($cat, $attr) {
  @if is-old-theme($cat, $attr) == true {
    @return get-old-color($cat, $attr);
  } @else {
    @return get-color-value($cat, $attr);
  }
}

@function get-css-var($cat, $attr) {
  $prefix: get-css-prefix();
  @if is-old-theme($cat, $attr) == true {
    @return #{$prefix}-#{get-old-css-var($cat, $attr)};
  }
  @return #{$prefix}-#{get-css-var-name($cat, $attr)};
}

@function get-rgb-css-var($cat, $attr) {
  $prefix: get-css-prefix-rgb();
  @if is-old-theme($cat, $attr) == true {
    @return #{$prefix}-#{get-old-css-var($cat, $attr)};
  }
  @return #{$prefix}-rgb-#{get-css-var-name($cat, $attr)};
}

@function theme-rgb($cat, $attr) {
  $prefix: get-css-prefix();
  $css-var: #{$prefix}-#{get-css-var-name($cat, $attr)};

  @if is-old-theme($cat, $attr) == true {
    $color: get-old-color($cat, $attr);
    $old-css-var: #{$prefix}-#{get-old-css-var($cat, $attr)};

    @return var($css-var, var($old-css-var, $color));
  }

  $color: get-color-value($cat, $attr);

  @return var($css-var, $color);
}

@function theme-rgba($cat, $attr, $opacity) {
  $prefix: get-css-prefix-rgb();
  $css-var: #{$prefix}-#{get-css-var-name($cat, $attr)};

  @if is-old-theme($cat, $attr) == true {
    $color: get-old-color($cat, $attr);
    $old-css-var: #{$prefix}-#{get-old-css-var($cat, $attr)};

    $css-var: var($css-var, var($old-css-var, to-rgb($color)));

    // `unquote` is a workaround for node-sass misinterprets rgba as builtin function
    // https://github.com/sass/node-sass/issues/2251
    // dart-sass doesn't seem to have this issue.
    @return unquote('rgba(#{$css-var}, #{$opacity})');
  }

  $color: get-color-value($cat, $attr);

  @return unquote('rgba(#{var($css-var, to-rgb($color))}, #{$opacity})');
}

@mixin theme-color($prop, $cat, $color-attr, $opacity: 1) {
  $color: get-color($cat, $color-attr);

  @if $opacity >= 1 {
    #{$prop}: $color;
    #{$prop}: theme-rgb($cat, $color-attr);
  } @else {
    #{$prop}: rgba($color, $opacity);
    #{$prop}: theme-rgba($cat, $color-attr, $opacity);
  }
}

@mixin theme-border-impl($prop, $width, $style, $cat, $attr, $opacity) {
  @include theme-color(#{$prop}-color, $cat, $attr, $opacity: 1);

  #{$prop}-width: $width;
  #{$prop}-style: $style;
}

@mixin theme-border($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-top($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-top, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-right($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-right, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-bottom($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-bottom, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-left($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-left, $width, $style, $cat, $i, $opacity);
}

// Font size
@function zent-font-size-var($attr) {
  $size: map-get($font-size, $attr);

  @return var(--font-size-#{$attr}, $size);
}

@function zent-size-var($map, $attr, $name) {
  $size: map-get($map, $attr);

  @return var(--#{$name}-#{$attr}, $size);
}

@mixin zent-font-weight($attr) {
  font-weight: map-get($font-weight, $attr);
  font-weight: zent-size-var($font-weight, $attr, 'font-weight');
}

@mixin zent-font-size($attr) {
  $font-size: map-get($font-size, $attr);
  $font-size-var: zent-font-size-var($attr);

  font-size: $font-size;
  font-size: $font-size-var;
  line-height: map-get($line-height, $attr);
  line-height: zent-size-var($line-height, $attr, 'line-height');
}

@mixin title-size($attr) {
  @include zent-font-weight(medium);
  @include zent-font-size($attr);
}

@mixin normal-size($attr) {
  @include zent-font-weight(normal);
  @include zent-font-size($attr);
}

@mixin zent-font($attr, $cat) {
  @if $cat == 'title' {
    @include title-size($attr);
  } @else {
    @include normal-size($attr);
  }
}

// Spacing
@function zent-spacing-value($attr) {
  @return zent-size-var($spacing, $attr, 'spacing');
}

@mixin zent-spacing($prop, $attr) {
  #{$prop}: map-get($spacing, $attr);
  #{$prop}: zent-spacing-value($attr);
}

// Border
@mixin zent-radius($attr: $medium) {
  border-radius: zent-size-var($border-radius, $attr, 'border-radius');
}

@mixin zent-border-width($prop, $attr: $medium) {
  #{$prop}-width: map-get($border-width, $attr);
  #{$prop}-width: zent-size-var($border-width, $attr, 'border-width');
}

// Shadow
$shadow-spec-focus-var: $shadow-size-focus theme-rgba(section, shadow, 0.1) !default;
$shadow-spec-layer-var: $shadow-size-layer theme-rgba(section, shadow, 0.1) !default;
$shadow-spec-modal-var: $shadow-size-modal theme-rgba(section, shadow, 0.1) !default;

$theme-shadow: (
  'focus': $shadow-spec-focus,
  'layer': $shadow-spec-layer,
  'modal': $shadow-spec-modal,
);

$theme-shadow-var: (
  'focus': $shadow-spec-focus-var,
  'layer': $shadow-spec-layer-var,
  'modal': $shadow-spec-modal-var,
);

@mixin theme-shadow($cat) {
  $shadow: map-get($theme-shadow, $cat);
  $shadow-var: map-get($theme-shadow-var, $cat);

  box-shadow: $shadow;
  box-shadow: var(--shadow-spec-#{$cat}, $shadow-var);
}
